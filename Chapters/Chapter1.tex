\chapter{总述} % Main chapter title

\label{Chapter1} % Change X to a consecutive number; for referencing this chapter elsewhere, use \ref{ChapterX}

架构支撑的操作系统安全增强
安全，一直是操作系统领域的一个重要方向。
一直以来，研究者们一直致力于保护数据的安全，
保证执行的可靠，
避免代码的 bug。
而由架构支撑的操作系统安全增强，则是其中非常有价值的一个方向。
安全与性能往往是需要权衡的，
加入更多的校验操作，
必然会使程序的运行变得缓慢。
启用硬件架构支撑的安全特性而非纯软件的实现，
可以大大提高安全校验操作的性能，
极大降低提高安全性所带来的开销。

%----------------------------------------------------------------------------------------
\section{硬件扩展的发展}
%----------------------------------------------------------------------------------------
近年来，不断有新的硬件支持的操作系统安全领域的技术出现。
随着技术的不断迭代，硬件扩展的安全技术向着更安全、更方便、更高效不断发展。
例如：
\begin{itemize}
    \item SMEP（Supervisor Mode Execution Prevention） 2011年
    \item SMAP（Supervisor Mode Access Prevention） 2012年
    \item MPX（Memory Protection eXtension）2013年
    \item MPK（Memory Protection Keys）2015年
    \item ARM Pointer Authentication 2017年
    \item Intel Control-flow Enforcement Technology 2018年
\end{itemize}
近年来，TEE 可信执行环境受到了学者们的关注。
在云服务器逐渐被用户接纳的当下，
如何让用户放心大胆的将自己的敏感数据与敏感计算放到云上去运行成为了难题。
TEE 的出现正能回答这个问题。
云服务提供商在自己的硬件设备中创建一个隔离的执行环境，
通过一系列手段使用户相信，在这个环境中执行的应用一定不会被篡改，
数据一定是安全的。
由此使用户敢于将敏感应用云端化，使用云端资源。
而如何构建一个可信执行环境 TEE，不同的硬件架构提供商给出了不同的解决方案。

%--------------------------------------
\subsection{ARM TrustZone}
%--------------------------------------
\paragraph{Normal World 和 Secure World}TrustZone通过TrustedFirmware这一硬件扩展，
将计算机资源划分为安全世界与普通世界。
同时带来与Intel不同的 EL0-EL3 这4个特权等级，
EL3被称为 monitor mode，
只有monitor mode 可以通过运行 ARM Trusted Firmware 来切换普通世界与安全世界。
一台有 TrustZone 的机器，
会经过安全的 bootloader 校验并启动安全世界中的操作系统，
而后，再切换到不可信的普通世界去执行。
%--------------------------------------
\subsection{Graphene-SGX}
%--------------------------------------
\paragraph{Intel SGX}Intel SGX技术通过硬件扩展，提供了 enclave 以及其相关的一些特性。
用户态应用程序可以部分或全部的放入 enclave执行，SGX技术可以保证，
在enclave中执行的程序不会被恶意的操作系统或恶意的Hypervisor攻击，
且数据不会泄露。
\paragraph{Haven}不过，
应用程序适配 SGX是一个挑战。
由于安全性的考虑，
encalve中的程序有一些操作不被允许（例如不能使用syscall），
因此，已有的应用程序想要利用 SGX 带来的安全性，
需要付出大量的重构努力。
OSDI 14 的一个叫 Haven 的工作,提出了带壳执行，证明了
可以将一个已有的二进制应用程序，
通过 libOS 的方式，整个放到enclave中执行。
通过对libOS的API实现进行修改，将底层实现缩小到更少的系统调用，
减少了攻击面。
再对这些与enclave外不受信任的操作系统或 hypervisor 沟通的方法进行校验。
保证出入enclave的控制流的可靠性，并对传输数据进行加密，
已有的应用程序就可以通过把整个二进制放入enclave中的方式利用SGX技术提供的安全性。
\paragraph{Graphene-SGX}Graphene-SGX在 Haven的基础上更进一步，
实现了enclave的安全fork与可信通信，
极大的提高了现有应用利用SGX技术时的可扩展性。
同时，由于硬件的发展，Graphene-SGX的测试还证明了
libOS化的应用程序放入enclave中所带来的开销是可以接受的。

%----------------------------------------------------------------------------------------
\subsection{RISC-V KeyStone}
%----------------------------------------------------------------------------------------
TODO

